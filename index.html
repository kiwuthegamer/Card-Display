<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;

            perspective: 1000px;
            background-color: #0F0F0F;

            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            -o-user-select: none;
            overflow: hidden;
        }

        #card-container {
            position: absolute;
            top: 50%;
            left: 50%;
            translate: -50% -50%;
            
            height: 40%;
            aspect-ratio: 1/1.4;

            transition: scale 0.2s linear;
        }
        
        #card-container:hover {
            scale: 1.1;
        }

        #card-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 10px;
            pointer-events: none;
        }

        #edit-menu {
            position: absolute;
            width: 12em;
            height: auto;
            right: -14em;
            padding: 1em;
            
            top: 50%;
            transform: translateY(-50%);
            transition: right 0.1s ease;
            
            background-color: #000000;
            border: solid 1px #fff;
            border-radius: 15px;
            
            color: #fff;
            font-family: sans-serif;
            font-size: 0.8em;
        }

        #edit-menu:hover {
            right: 0em;
        }
    </style>
    <title>Card Display</title>
</head>
<body>
    <div id="card-container" onclick="refresh()">
        <iframe src="https://kiwuthegamer.github.io/Balatro-Card-API/?cards=1&basicOnly=1"></iframe>
    </div>
    <div id="edit-menu">
        <div> <input type="checkbox" id="option-cards" checked="true" onclick="refresh()"><label for="option-cards">Playing cards</label> </div>
        <div> <input type="checkbox" id="option-basic" onclick="refresh()"><label for="option-basic">Modified playing cards</label> </div>
        <div> <input type="checkbox" id="option-jokers" onclick="refresh()"><label for="option-jokers">Jokers</label> </div>
        <div> <input type="checkbox" id="option-special" disabled onclick="refresh()"><label for="option-special">Special case jokers</label> </div>
    </div>
    <script>
        let card = document.querySelector("#card-container");

        document.body.addEventListener("mousemove", (e) => {
            if(e.target.id == "card-container") {
                var x = (innerWidth / 2 - e.pageX) / -10;
                var y = (innerHeight / 2 - e.pageY) / 10;
            } else {
                var x = (innerWidth / 2 - e.pageX) / -15;
                var y = (innerHeight / 2 - e.pageY) / 15;
            }
            var mouseX = e.pageX;
            var mouseY = e.pageY;
            card.style.transform = `rotateY(${x}deg) rotateX(${y}deg)`;
        });

        document.body.addEventListener("mouseenter", (e) => {
            card.style.transition = "transform 0.2s linear, scale 0.2s linear"
            setTimeout(function(){ card.style.transition = "scale 0.2s linear" }, 200);
        })

        document.body.addEventListener("mouseleave", (e) => {
            card.style.transition = "transform 0.2s linear, scale 0.2s linear"
            card.style.transform = "rotateY(0deg) rotateX(0deg)";
            setTimeout(function(){ card.style.transition = "scale 0.2s linear" }, 200);
        });

        document.getElementById('option-cards').onchange = function() {
            document.getElementById('option-basic').disabled = !this.checked;
            document.getElementById('option-basic').checked = false;

        };

        document.getElementById('option-jokers').onchange = function() {
            document.getElementById('option-special').disabled = !this.checked;
            document.getElementById('option-special').checked = false;
        };

        let refreshing = 0
        function refresh(){
            if (refreshing == 1) { return }

            refreshing = 1

            var iframe1 = document.querySelector('#card-container > iframe');
            var iframe2 = document.createElement('iframe');

            iframe1.style.opacity = 0.5;
            
            option_cards = document.querySelector("#option-cards").checked+0;
            option_basic = document.querySelector("#option-basic").checked+0;
            option_jokers = document.querySelector("#option-jokers").checked+0;
            option_special = document.querySelector("#option-special").checked+0;

            iframe2.src = "https://kiwuthegamer.github.io/Balatro-Card-API/?cards=" + option_cards + "&basicOnly=" + (1-option_basic) + "&jokers=" + option_jokers + "&specialCases=" + option_special;

            iframe2.style.visibility = 'hidden';
            card.appendChild(iframe2);

            iframe2.onload = function() {
                card.removeChild(iframe1);
                iframe2.style.visibility = 'visible';
                refreshing = 0
            }
        }
    </script>
</body>
</html>
